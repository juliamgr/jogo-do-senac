<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="stylesheet" href="julia.css">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Alfa+Slab+One&family=Comic+Neue:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&family=Danfo&family=Gloria+Hallelujah&family=Londrina+Sketch&family=Rubik+Wet+Paint&display=swap" rel="stylesheet">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Alfa+Slab+One&family=Comic+Neue:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&family=Danfo&family=Gloria+Hallelujah&family=Londrina+Sketch&family=Patrick+Hand+SC&family=Rubik+Wet+Paint&display=swap" rel="stylesheet">


   
    
</div>
    <div class="armario">
        
        <IMG  class="armario2" src="lockeruou.png">
            <IMG  class="armario2" src="lockeruou.png">
                <IMG  class="armario2" src="lockeruou.png">
                    <IMG  class="armario2" src="lockeruou.png">
                        <IMG  class="armario2" src="lockeruou.png">
                            <IMG  class="lixo" src="LIXEIRA-AZUL-50L-SEM-POSTE-JSN (1).png">
                            
                    

    </div>
    <div class="caixa" id="caixa">
    <button id="msala" class="msala" style="display: none;">Sair</button>
    </div>


<div id="textbox">
    <h1></h1>
   
    <button id="open-button" class="hidden">Falar</button>
</div>
   <!-- <div class="visoria">-->
        <img  class="vioria" src="anita_lora__1_-removebg-preview.png" width="300px" height="200px"  />
    </div>
    <div class="julia paia">
        <img class="jolia" src="julia tristona.png">
    </div>
    <div class="saida1"></div>
    <div class="saida2"></div>
    <div id="elemento" class="elemento">
                
        <!-- Trigger/Open The Modal -->
        
        <button id="botao" class="botao" style="display: none;">Interagir</button>
      </div>
   
    <div class="entrada" img src="wall.png">
        
        <div class="door"></div>
       
    </div>
    
    <img class="tia" src="tiaartic.png">
    
    
    <canvas id="Canva" width="1" height="1"></canvas> <!-- Tamanho da tela -->
   
    
        
    </DIV>
    <title>Quadrado Móvel</title>
   
</head>
<body>



<div id="square">
    <img id="square-gif" src="./dimiparado.png" width="50%" >
</div>

<!-- The Modal -->
<div id="modalPers1" class="modal">
    <!-- Modal content --><div class="textbox" >
    <H1 class="texto">Olá você deve ser o aluno novo, Demetrios não é mesmo?</H1>
    <H1 class="name">  Tia Artic</H1>
    
    <img id="fototia" src="https://m.media-amazon.com/images/I/41F35zLfl-L._AC_.jpg">
    <button class="btn" onclick="mudarTexto()">Próximo</button>
    <div class=>
      <span class="close">&times;</span>
      
    </div>
</div>
<div id="modalPers2" class="modal">
    <!-- Modal content -->
    <div class="modal-content">
      <span class="close">&times;</span>
      <p>Some text in the Modal..</p>
    </div>
</div>
<div id="modalPers3" class="modal">
    <!-- Modal content -->
    <div class="modal-content">
      <span class="close">&times;</span>
      <p>Some text in the Modal..</p>
    </div>
</div>


<script>
    const canvas = document.getElementById('Canva');
    const square = document.getElementById('square');
    const squareGif = document.getElementById('square-gif');
    const ctx = canvas.getContext('2d');
    const tia = document.querySelector('.tia'); 
    const jolia = document.querySelector('.jolia'); 
    const vioria = document.querySelector('.vioria'); 
    const openButton = document.getElementById("open-button");
    const elemento = document.getElementById('elemento');
const botao = document.getElementById('botao');


  function verificarProximidade() {
  const posSquare = square.getBoundingClientRect();
  const posElemento = tia.getBoundingClientRect();
  const posElemento2 = jolia.getBoundingClientRect();
  

let distancia = posElemento.x-posSquare.x;
  console.log(distancia);
  if ( distancia < 120) {
    botao.style.display = 'block';
    console.log('colidiu');
  } else {
    botao.style.display = 'none';
    console.log('ainda nao');
  }
}

  

document.addEventListener('keydown', function(e) {
  const step = 5; // A cada tecla pressionada, o personagem se move 5px

  if (e.key === 'ArrowUp') {
    personagem.style.top = (parseInt(personagem.style.top || 0) - step) + 'px';
  } else if (e.key === 'ArrowDown') {
    personagem.style.top = (parseInt(personagem.style.top || 0) + step) + 'px';
  } else if (e.key === 'ArrowLeft') {
    personagem.style.left = (parseInt(personagem.style.left || 0) - step) + 'px';
  } else if (e.key === 'ArrowRight') {
    personagem.style.left = (parseInt(personagem.style.left || 0) + step) + 'px';
  }

  // Verifica a proximidade após o movimento
  verificarProximidade();
});

const textos = [
            "Já vi que você ja conheceu alguns dos nossos alunos!",
            "Eu sou a Tia Artic, professora da escola, e vou te ajudar neste processo de começar em uma escola nova!",
            "Bom nosso colégio funciona por um sistema de diversas matérias, e você precisa passar em todas elas para passar de ano, mas se você não passar nas provas voltará para a FARRAPOS!!, e terá que fazer tudo novamente.",
            "Mas não se preocupe pois você ainda pode ser divertir e se distrair durante este processo de ano letivo.",
            "Muitos dos nossos alunos são muito legais e adoram conhecer novas pessoas, você vai adorar eles, estão sempre deixando coisas pela escola, talvez uma hora você encontre algo deles.",
"Qualquer coisa que precisar é só perguntar que vou tentar ajudar do modo que puder!"
        ];

         // Variável para controlar o índice do texto atual
         let indiceTexto = 0;

         function mudarTexto() {
            document.querySelector('.texto').textContent = "Bem-vindo, Dimitri! Vamos começar o aprendizado.";
        }
// Função para mudar o texto
function mudarTexto() {
    // Atualiza o texto do elemento com a classe .texto com o texto atual do array
    document.querySelector('.texto').textContent = textos[indiceTexto];
    
    // Incrementa o índice para o próximo texto
    indiceTexto++;

    // Se o índice for maior ou igual ao número de textos, volta ao início
    if (indiceTexto >= textos.length) {
        indiceTexto = 0;
    }
}
// Verifica a proximidade inicialmente
verificarProximidade();



    let posX = canvas.width / -2; 
    let posY = canvas.height / -30;
    const step = 15; //
    const width = square.offsetWidth;  // Largura do quadrado
    const height = square.offsetHeight; // Altura do quadrado
    let gifAtivo = false; // Controle para saber se o gif está animado ou não

    // Variável de controle das teclas pressionadas
    let movingKeys = {
        w: false,
        a: false,
        s: false,
        d: false
    };

    function verificarColisao() {
    const rectPersonagem = square.getBoundingClientRect();
    const rectTia = tia.getBoundingClientRect();
    const rectJolia = jolia.getBoundingClientRect();
    const rectvioria = vioria.getBoundingClientRect();

    
    const colisaoTia = !(rectPersonagem.right <= rectTia.left || 
                        rectPersonagem.left >= rectTia.right || 
                        rectPersonagem.bottom <= rectTia.top || 
                        rectPersonagem.top >= rectTia.bottom);
                        
                        

    
    const colisaoJolia = !(rectPersonagem.right <= rectJolia.left || 
                          rectPersonagem.left >= rectJolia.right || 
                          rectPersonagem.bottom <= rectJolia.top || 
                          rectPersonagem.top >= rectJolia.bottom);

  const colisaovioria= !(rectPersonagem.right <= rectvioria.left || 
                        rectPersonagem.left >= rectvioria.right || 
                        rectPersonagem.bottom <= rectvioria.top || 
                        rectPersonagem.top >= rectvioria.bottom);
                        
    
    return colisaoTia || colisaoJolia ||colisaovioria;
}






function moverPersonagem() {
    
    if (movingKeys.w) {
       
        posY = Math.max(posY - step, -210);  // Limite superior
        squareGif.src = './dimi de costa (1).gif';
    }
    if (movingKeys.s) {
        // Permite o movimento para baixo sem bloquear completamente
        posY = Math.min(posY + step, window.innerHeight - height, 200);  // Limite inferior
        squareGif.src = './didmitrinho (1).gif';
    }
    if (movingKeys.a) {
        // Permite o movimento para a esquerda sem bloquear completamente
        posX = Math.max(posX - step, -620);  // Limite esquerdo
        squareGif.src = './dimi esq.gif';

        square.style.transform = `translate(${posX}px, ${posY}px) rotateY(180deg)`;
    }
    if (movingKeys.d) {
       
        posX = Math.min(posX + step, window.innerWidth - width, 510);  // Limite direito
        squareGif.src = './dimi dir.gif';
        //squareGif.classList.add("oitudobem");
        square.style.transform = `translate(${posX}px, ${posY}px) rotateY(0deg)`;
    }

    
    if (verificarColisao()) {
        
        if (movingKeys.a) {
            posX = Math.min(posX + step, window.innerWidth - width, 200); // Mover para direita caso tenha colidido
        }
        if (movingKeys.d) {
            posX = Math.max(posX - step, -620); // Mover para esquerda caso tenha colidido
        }
        if (movingKeys.w) {
            posY = Math.min(posY + step, 200, window.innerHeight - height); // Mover para baixo caso tenha colidido
        }
        if (movingKeys.s) {
            posY = Math.max(posY - step, -210); // Mover para cima caso tenha colidido
        }
    }

    
    square.style.transform = `translate(${posX}px, ${posY}px)`;
}

       
    
    

  
    // Detecta quando uma tecla é pressionada
    window.addEventListener('keydown', (e) => {
        if (['w', 'a', 's', 'd'].includes(e.key)) {
            movingKeys[e.key] = true;
            moverPersonagem();
        }
    });

    // Detecta quando uma tecla é liberada
    window.addEventListener('keyup', (e) => {
        if (['w', 'a', 's', 'd'].includes(e.key)) {
            movingKeys[e.key] = false;
        }
        
        // Se nenhuma tecla de movimento for pressionada, o gif será parado
        if (!Object.values(movingKeys).includes(true)) {
            gifAtivo = false;
            squareGif.src = './dimiparado.png'; // Coloca a imagem estática quando o gif não está em movimento
        }
    });

    // Função para desenhar o canvas (opcional, você pode adicionar outras coisas no canvas)
    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height); // Limpa o canvas
        
        requestAnimationFrame(draw); // Redesenha o canvas
    }

    
    draw();


// Get the modal
var modalPers1 = document.getElementById("modalPers1");

// Get the button that opens the modal
var btn = document.getElementById("botao");

// Get the <span> element that  '' closes the modal
var span = document.getElementsByClassName("close")[0];

// When the user clicks the button, open the modal 
btn.onclick = function() {
    modalPers1.style.display = "block";
}

// When the user clicks on <span> (x), close the modal
span.onclick = function() {
    modalPers1.style.display = "none";
}

// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event) {
  if (event.target == modalPers1) {
    modalPers1.style.display = "none";
  }
}

// Checar colisão com o mouse
function checkCollision(mouseX, mouseY) {
    if (mouseX >= square.x && mouseX <= square.x + square.width &&
        mouseY >= square.y && mouseY <= square.y + square.height) {
        return true; // Colidiu com o quadrado
    }
    return false;
}






function updateCanvas() {
    drawSquare(); // Desenha o quadrado (com a imagem)
    requestAnimationFrame(updateCanvas); // Faz o loop de animação
}

img.onload = function() {
    updateCanvas(); 
}


</script>


</body>
</html>